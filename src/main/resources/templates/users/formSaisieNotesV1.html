<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="users/userslayout">
<head>
<meta charset="UTF-8"/>
<title>Saisie des notes</title>
</head>
<body onload="donneFocus()">

<span layout:fragment="titre_boite">
        Formulaire de saisie des notes de  
	<span th:inline="text" class="alert alert-warning"> Séquence  [[${sequenceConcerne.numeroSeq}]]: [[${coursConcerne.codeCours}]]
		[[${coursConcerne.intituleCours}]].
	</span>
</span>

<div layout:fragment="formactionusers">
<!-- DEBUT DU FORMULAIRE PERMETTANT D'EFFECTUER L'ACTION DEMANDEE   col-md-offset-1-->
	<div class="col-md-9">
		<form action="#" class="form-inline"
				th:action="@{/logesco/users/getUpdateNoteSaisieV1}" method="get">
					
					<input type="hidden" name="effectifclasse" id="effectifclasse" 
						class="form-control" th:value="${effectifclasse}"/>
					
					<div th:if="${param.updatenotesaisiErrorsaveEval}">
						<h4 align="justify" class="alert alert-danger">
							Vérifier que la proportion saisie est comprise entre 0 et  100 et si c'est le cas contacter l'administrateur.
						</h4>
					</div>
					
					<div th:if="${param.updatenotesaisierrorNote}">
						<h4 align="justify" class="alert alert-danger">Erreur système lors de l'enregistrement de la notes d'évaluation.</h4>
					</div>
					
					<div th:if="${param.updatenotesaisiError}">
						<h4 align="justify" class="alert alert-danger">Valeur de note ou de proportion érronée.</h4>
					</div>
					
					<div th:if="${param.updatenotesaisiError1}">
						<h4 align="justify" class="alert alert-danger">
							La note d'un l'élève est érronée.
						</h4>
					</div>
					
					<div th:if="${param.updatenotesaisiwarningElv}">
						<h4 align="justify" class="alert alert-warning">Note enregistrée avec succès. Il y a pas d'élève suivant dans la liste.</h4>
					</div>
					
					<div th:if="${param.updatenotesaisiwarningElvPre}">
						<h4 align="justify" class="alert alert-warning"> Il y a pas d'élève précédent dans la liste.</h4>
					</div>
					
					<div th:if="${param.updatenotesaisiSucces}">
						<h4 align="justify" class="alert alert-success">
							Toutes les notes marquées d'un OK sont enregistrées avec succès.
						</h4>
					</div>
					
					<div th:if="${param.numeroElvErrone}">
						<h4 align="justify" class="alert alert-danger">Saisir un numéro valide</h4>
					</div>
					
					<div th:if="${param.rechEleveNull}">
						<h4 align="justify" class="alert alert-success">Saisir un numéro valide</h4>
					</div>
					
					<table class="table table-striped">
							<thead>
								<tr>
									<th>
										<div class="form-group" th:if="${evaluationConcerne}">
											<label th:inline="text"> Evaluation: <span
												class="redcolor"><!-- [[${evaluationConcerne.typeEval}]] -->
													[[${evaluationConcerne.typeEval=='DS'}?'Devoir 2':'Devoir 1 ' ]]</span></label>
											
											<input type="hidden" name="idEval" id="idEval" 
												class="form-control" th:value="${evaluationConcerne.idEval}" />
											
										</div>
									</th>
									<th>
										<div class="form-group" th:if="${evaluationConcerne}">
											<label th:inline="text"> Comptant pour: &nbsp;&nbsp;&nbsp;</label>
											<input type="text" name="proportionEval" id="proportionEval" 
												class="form-control redcolor" th:value="${evaluationConcerne.proportionEval}" />
												
										</div>
									</th>
									<th>
										<div>
											<label th:inline="text" th:if="${evaluationAssocie}"> 
												Donc <span class="redcolor">[[${evaluationAssocie.proportionEval}]]%</span>  
												pour <span class="redcolor">
													[[${evaluationAssocie.typeEval=='DS'}?'Devoir 2':'Devoir 1 ' ]]
												 <!-- [[${evaluationAssocie.typeEval}]] --></span> </label>
										</div>
									</th>
								</tr>
								
								<tr>
									<th>Numéro</th>
									<th>Noms et prénoms</th>
									<th th:inline="text">Note([[${evaluationConcerne.typeEval}]])/20</th>
									<th></th>
								</tr>
							</thead>
							<tbody th:if="${listofAllEleve}">
							
								<tr th:each="eleve:${listofAllEleve}" >
									
									<td th:inline="text"><b>[[${eleve.getNumero(listofAllEleve)}]]</b> </td>
							
									<td th:inline="text"><b>[[${#strings.capitalize(eleve.nomsEleves)}]] [[${eleve.prenomsEleves}]]</b> </td>
									
									<td th:inline="text">
										
										<input type="text" th:name="noteSaisi+${eleve.idEleves}+${evaluationConcerne.idEval}"  
											th:id="noteSaisi+${eleve.idEleves}+${evaluationConcerne.idEval}"   
											th:onblur="'javascript:enreg('+${eleve.idEleves}+','+${evaluationConcerne.idEval}+')'"
											th:tabindex="${eleve.getNumero(listofAllEleve)}"
											onkeyup="enterTab(this,event)"
												class="form-control" th:value="${eleve.getNotesEvalCoursSeq(coursConcerne.idCours,sequenceConcerne.idPeriodes,typeEval) != null}?
										${eleve.getNotesEvalCoursSeq(coursConcerne.idCours,sequenceConcerne.idPeriodes,typeEval).valeurnoteEval}:'0'" />
										
										
									
									</td>
									
									<td>
										<!-- <img alt="Ici le logo de l'application"  src="../static/images/logopng.png"  /> -->
										<label th:id="reponseServeur+${eleve.idEleves}+${evaluationConcerne.idEval}"></label> 
									</td>
									
								</tr>
								
							</tbody>
						</table>
						<!-- <input type="text" id="valeurSaisi" />
						<button type="submit" class="btn btn-primary btn-sm  pull-right">Valider l'enregistrer</button>--> 
				</form>
				
				<br/><br/>
				
				<a class="btn btn-default btn-sm pull-left" href="#" 
						th:href="@{/logesco/users/getNotesEvalClasse(idClasseConcerne=${evaluationConcerne.cours.classe.idClasses}, 
						idEvalConcerne=${evaluationConcerne.idEval})}" role="button" target="_blank">
						<span class="glyphicon glyphicon-cloud-download"></span> Afficher le relevé
				</a>
				
				
				<a class="btn btn-default btn-sm pull-right" href="#" 
						th:href="@{/logesco/users/getNotesFinaleClasse(idClasse=${evaluationConcerne.cours.classe.idClasses}, 
						idCours=${evaluationConcerne.cours.idCours},idSequence=${sequenceConcerne.idPeriodes})}" 
						role="button" target="_blank">
					<span class="glyphicon glyphicon-cloud-download"></span> Relevé de note séquentiel
				</a>
			
				<br/><br/>
				<a class="btn btn-default btn-sm pull-left" href="#" title="Retourner à la page précédente"
						th:href="@{/logesco/users/getdonneesSaisieNotesV1(idClassesConcerne=${evaluationConcerne.cours.classe.idClasses}, 
						idAnneeActive=${sequenceConcerne.trimestre.annee.idPeriodes})}" role="button">
						<span class="glyphicon glyphicon-menu-left"></span> Retourner
					</a>
				
				
	</div>
	
	
	
	
<!-- fin DU FORMULAIRE PERMETTANT D'EFFECTUER L'ACTION DEMANDEE -->
<!-- On peut inserer du javascript ici ie le javascript qui concerne exclusivement cette page. -->

<script type="text/javascript">
//alert("dd");
	function donneFocus(){
		//alert("donne focus");
		document.getElementById('noteSaisi').focus();
	}
	
	
	function enreg(idEleve, idEval){
		//alert(idEleve+" "+idEval);
		var idInput = "noteSaisi"+idEleve+""+idEval;
		var idresult = "reponseServeur"+idEleve+""+idEval;
		//alert(idInput);
		//var valeurSaisi = document.getElementById(idInput).val();
		var valeurSaisi =  $('#'+idInput).val();
		var proportionEval =  $('#proportionEval').val();
		
		//alert(valeurSaisi);proportionEval
		/* $('#valeurSaisi').val(valeurSaisi); */
		//var parametres="idEleves="+idEleve;
		$.ajax({
			type: 'GET',
			url: '/logesco/users/ajaxrestusers/enregNote/'+idEleve+"/"+idEval+"/"+proportionEval+"/"+valeurSaisi,
			success: function(result){
				//alert(""+result);
				$('#'+idresult).text(result);
				/* if(result == "1"){
					//alert('#'+idresult);
					//$('#'+idresult).text("EXCELLENT");
					$('#'+idresult).text(mention(valeurSaisi));
				}
				else{
					$('#'+idresult).text("KO");
				}  */
			}
		});
		
	}
	
	function enterTab(input,event){
		//alert("autre test");
		if( event.which == 13 ){
			var tab = parseInt(input.getAttribute("tabindex"));
			var tabp=tab;
			var tab = tab+1;
			var effectifclasse =  $('#effectifclasse').val();
			//alert("autre test "+effectifclasse);
			if(tabp == effectifclasse){
				tab = 1;
			}
			
			 var allFields = document.getElementsByTagName("input");
			 //alert("les input "+allFields.length);
		        for (var i=0; i!=allFields.length; i++) {
		        	//alert("un de ces input "+parseInt(allFields[i].getAttribute("tabindex")));
		            if (parseInt(allFields[i].getAttribute("tabindex")) == tab) {
		            	//alert("le input qui doit prendre le focus "+allFields[i]);
		                allFields[i].focus();
		                allFields[i].select(); 
		                //if (!undoSelect) { allFields[i].select(); }
		            }
		        }
			}
	}
	
	function enterpress(idEleve, idEval, event){
		//alert("enter press in this input text");
		if( event.which == 13 ){
	        //On va au serveur chercher l'id de l'elve suivant
	        
			var idInput = "noteSaisi"+idEleve+""+idEval;
			 document.getElementById(idInput).blur();
	    }
	}	
</script>
</div>
</body>
</html>